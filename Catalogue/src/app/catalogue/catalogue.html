<!-- ================= LANGUAGE SELECTION MODAL ================= -->
<div *ngIf="showLanguageModal" class="language-modal-overlay">
  <div class="language-modal">
    <div class="modal-header">
      <h1 class="modal-title">Bienvenue / Welcome</h1>
      <p class="modal-subtitle">Veuillez choisir votre langue / Please select your language</p>
    </div>
    
    <div class="language-options">
      <button class="language-option-btn" (click)="selectLanguage('fr')">
        <span class="flag"><img class="logo-france" src="../../assets/icon-france.png"></span>
        <span class="lang-name">Fran√ßais</span>
        <span class="arrow">‚Üí</span>
      </button>
      
      <button class="language-option-btn" (click)="selectLanguage('en')">
        <span class="flag"><img class="logo-anglais" src="https://cdn-icons-png.flaticon.com/512/1377/1377975.png"></span>
        <span class="lang-name">English</span>
        <span class="arrow">‚Üí</span>
      </button>
    </div>
  </div>
</div>

<!-- ================= COVER PAGE ================= -->
<div class="background-animation"></div>
<div *ngIf="showCover" class="cover-page">
  
  <!-- Floating Images -->
  <div class="floating-images">
    <img src="assets/Media1.jpg" alt="Formation 1" class="float-img img-1">
    <img src="assets/Media2.jpg" alt="Formation 2" class="float-img img-2">
    <img src="assets/Media3.jpg" alt="Formation 3" class="float-img img-3">
    <img src="assets/Media4.jpg" alt="Formation 4" class="float-img img-4">
    <img src="assets/Media5.jpg" alt="Formation 5" class="float-img img-5">
    <img src="assets/Media6.jpg" alt="Formation 6" class="float-img img-6">
    <img src="assets/Media7.jpg" alt="Formation 7" class="float-img img-7">
    <img src="assets/Media8.jpg" alt="Formation 8" class="float-img img-8">
  </div>
  
  <!-- Main Content -->
  <div class="cover-content">
    <div class="content-wrapper">
      <h1 class="title">{{ translations.catalogueTitle }}</h1>
      <div class="video-box">
        <video class="intro-video" autoplay muted loop playsinline>
          <source src="assets/TeamwillV.mp4" type="video/mp4">
        </video>
      </div>
      <p class="subtitle">{{ translations.welcomeSubtitle }}</p>
      
      <div class="features">
        <span class="feature-tag">{{ translations.feature1 }}</span>
        <span class="feature-tag">{{ translations.feature2 }}</span>
        <span class="feature-tag">{{ translations.feature3 }}</span>
      </div>
      
    </div>
  </div>
  
  <!-- Slide-up Button -->
  <div class="button-container">
    <button (click)="startCatalogue()" class="start-button">
      <span>{{ translations.startButton }}</span>
      <svg class="arrow-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M5 12h14M12 5l7 7-7 7"/>
      </svg>
    </button>
    <a routerLink="/login" class="login-link" routerLinkActive="active">
    <span>{{ translations.seconnecter }}</span>
  </a>
  </div>
</div>

<!-- ================= CATALOGUE CONTENT ================= -->
<div *ngIf="showCatalogue" class="catalogue-container"> 
  <!-- Sidebar --> 
  <div class="sidebar">
    <div class="sidebar-header">
      <h1 class="sidebar-title">{{ translations.catalogueTitle }}</h1>
      <p class="sidebar-subtitle">{{ translations.page }} {{ currentPage + 1 }} / {{ getVisibleFormations().length }}</p>

    
    

      <!-- View Toggle -->
      <div class="view-toggle">
        <button 
          class="view-button" 
          [ngClass]="{'active': currentView === 'axe'}"
          (click)="currentView = 'axe'">
          {{ translations.formations }}
        </button>
        <button 
          class="view-button" 
          [ngClass]="{'active': currentView === 'parcours'}"
          (click)="currentView = 'parcours'">
          {{ translations.parcours }}
        </button>
      </div>
    </div>
  
    <div class="sidebar-content">
      <h3 class="sommaire-title">{{ translations.sommaire }}</h3>

      <!-- VIEW BY AXE -->
      <div *ngIf="currentView === 'axe'" class="view-content">
        <ng-container *ngFor="let axeGroup of groupedFormations; let i = index">
          <div class="axe-section" [class.collapsed]="collapsedAxes[i]">
            <div class="axe-header" (click)="toggleAxe(i)">
              <div class="axe-header-content">
<div class="axe-name">{{ translateAxe(axeGroup.axe) }}</div>              </div>
              <svg class="axe-toggle" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </div>

            <div class="axe-content">
              <ng-container *ngFor="let typeGroup of axeGroup.types">
                <div class="type-section">
                  <ng-container *ngFor="let statusGroup of typeGroup.interneExterne">
                    <div class="status-section">
                      <div class="status-header">
                        <div class="type-name">{{ statusGroup.status | titlecase }}</div>
                      </div>
                      <div class="formation-list">
                        <button 
                          *ngFor="let formation of statusGroup.formations"
                          class="formation-item"
                          [class.active]="isCurrentPageFormation(formation)"
                          (click)="goToPage(getVisibleFormations().indexOf(formation))">
                          <span class="formation-title">{{ formation.intitule }}</span>
                          <div *ngIf="isCurrentPageFormation(formation)" class="active-indicator"></div>
                        </button>
                      </div>
                    </div>
                  </ng-container>
                </div>
              </ng-container>
            </div>
          </div>
        </ng-container>
      </div>

      <!-- VIEW BY PARCOURS -->
<div *ngIf="currentView === 'parcours'" class="view-content">
  <div *ngFor="let parcours of groupedParcours; let parcoursIndex = index" class="parcours-section">
    
    <!-- Parcours Header - Now Clickable -->
    <div class="parcours-header" 
         [class.collapsed]="collapsedParcours[parcoursIndex]"
         (click)="toggleParcours(parcoursIndex)">
      <div class="parcours-header-left">
        <svg class="parcours-toggle" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
        </svg>
<div class="parcours-name">{{ translateParcours(parcours.name) }}</div>      </div>
      <span class="parcours-count">{{ parcours.count }} {{ translations.formations }}</span>
    </div>

    <!-- Parcours Content - Collapsible -->
    <div class="parcours-content" [class.hidden]="collapsedParcours[parcoursIndex]">
      
      <!-- Other Parcours: Group by Axes -->
      <ng-container *ngIf="parcours.axes">
        <ng-container *ngFor="let axeGroup of parcours.axes; let a = index">
          <div class="axe-section" [class.collapsed]="collapsedParcoursAxes[parcours.name]?.[a]">
            <div class="axe-header" (click)="toggleParcoursAxe(parcours.name, a)">
              <div class="axe-header-content">
<div class="axe-name">{{ translateAxe(axeGroup.axe) }}</div>          </div>
              <svg class="axe-toggle" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </div>

            <div class="axe-content">
              <ng-container *ngFor="let typeGroup of axeGroup.types">
                <div class="type-section">
                  <ng-container *ngFor="let statusGroup of typeGroup.interneExterne">
                    <div class="status-section">
                      <div class="status-header">
                        <div class="type-name">{{ statusGroup.status | titlecase }}</div>
                      </div>
                      <div class="formation-list">
                        <button 
                          *ngFor="let formation of statusGroup.formations"
                          class="formation-item"
                          [class.active]="isCurrentPageFormation(formation)"
                          (click)="goToPage(getVisibleFormations().indexOf(formation))">
                          <span class="formation-title">{{ formation.intitule }}</span>
                          <div *ngIf="isCurrentPageFormation(formation)" class="active-indicator"></div>
                        </button>
                      </div>
                    </div>
                  </ng-container>
                </div>
              </ng-container>
            </div>
          </div>
        </ng-container>
      </ng-container>

      <!-- OnBoarding: Group by Pays -->
      <ng-container *ngIf="parcours.pays">
        <ng-container *ngFor="let paysGroup of parcours.pays; let p = index">
          <div class="axe-section" [class.collapsed]="collapsedParcoursAxes[parcours.name]?.[p]">
            <div class="axe-header" (click)="toggleParcoursAxe(parcours.name, p)">
              <div class="axe-header-content">
                <div class="axe-name"> {{ paysGroup.paysName }}</div>
              </div>
              <svg class="axe-toggle" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </div>

            <div class="axe-content">
              <ng-container *ngFor="let statusGroup of paysGroup.interneExterne">
                <div class="status-section">
                  <div class="status-header">
                    <div class="type-name">{{ statusGroup.status | titlecase }}</div>
                  </div>
                  <div class="formation-list">
                    <button 
                      *ngFor="let formation of statusGroup.formations"
                      class="formation-item"
                      [class.active]="isCurrentPageFormation(formation)"
                      (click)="goToPage(getVisibleFormations().indexOf(formation))">
                      <span class="formation-title">{{ formation.intitule }}</span>
                      <div *ngIf="isCurrentPageFormation(formation)" class="active-indicator"></div>
                    </button>
                  </div>
                </div>
              </ng-container>
            </div>
          </div>
        </ng-container>
      </ng-container>

    </div>
  </div>
</div>
    </div>
  </div>

  <!-- Main Content --> 
  <div class="main-content">
    <div class="book-container">
      <div 
        class="book-page" 
        *ngIf="currentFormation"
        [class.page-flip-out]="pageFlipDirection === 'forward'"
        [class.page-flip-back-out]="pageFlipDirection === 'backward'">
      
        <div class="page-content">
          <img 
            src="https://universitesesame.com/wp-content/uploads/2022/09/logo-teamwill.png"
            alt="TeamWill Logo"
            style="width:170px; height:auto; float:right; margin:5px;">
          
          <!-- Page Header -->
          <div class="page-header">
            <span class="category-badge">{{ currentFormation.axe_code }}</span>
            <h2 class="formation-main-title">{{ currentFormation.intitule }}</h2>
            <p class="formation-description">{{ currentFormation.duree }}</p>
          </div>

          <!-- Information Grid -->
          <div class="info-grid">
            <div class="info-card">
              <div class="info-card-header">
                <span class="info-label">
                  {{ currentFormation.interne_externe === 'externe' ? translations.provider : translations.trainer }}
                </span>
              </div>
              <p class="info-value">
                {{ currentFormation.interne_externe === 'externe' 
                   ? (currentFormation.prestataire || 'N/A') 
                   : (currentFormation.formateur || 'N/A') }}
              </p>
            </div>

            <div class="info-card">
              <div class="info-card-header">
                <span class="info-label">{{ translations.level }}</span>
              </div>
              <span [class]="'niveau-badge ' + getNiveauColor(currentFormation.niveau || '')">
                {{ currentFormation.niveau || 'N/A' }}
              </span>
            </div>

            <div class="info-card">
              <div class="info-card-header">
                <span class="info-label">{{ translations.population }}</span>
              </div>
              <p class="info-value">{{ currentFormation.population || 'N/A' }}</p>
            </div>
          </div>

          <!-- Objectifs -->
          <div class="section">
            <h3 class="section-title">
              <div class="title-bar"></div> {{ translations.objectives }}
            </h3>
            <ul class="objectifs-list">
              <li *ngFor="let objectif of currentFormation.objectifs || []; let i = index" class="objectif-item">
                <div class="objectif-number">{{ i + 1 }}</div>
                <span class="objectif-text">{{ objectif }}</span>
              </li>
            </ul>
          </div>

          <!-- Comp√©tences -->
          <div class="section">
            <h3 class="section-title">
              <div class="title-bar competences-bar"></div> {{ translations.skills }}
            </h3>
            <ul class="competences-list">
              <li *ngFor="let competence of currentFormation.competences || []" class="competence-item">
                {{ competence }}
              </li>
            </ul>
          </div>

          <!-- Pr√©requis -->
          <div class="section">
            <h3 class="section-title">
              <div class="title-bar prerequis-bar"></div> {{ translations.prerequisites }}
            </h3>
            <div class="prerequis-box">
              <p class="prerequis-text">{{ currentFormation.prerequis }}</p>
            </div>
          </div>
        </div>

        <!-- Page Footer -->
        <div class="page-footer">{{ translations.page }} {{ currentPage + 1 }} / {{ getVisibleFormations().length }}</div>
      </div>

      <!-- Navigation Buttons -->
      <button 
        (click)="prevPage()" 
        [disabled]="!canGoPrevious()" 
        class="nav-button nav-prev" 
        [class.disabled]="!canGoPrevious()">
        <svg class="icon-nav" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <polyline points="15 18 9 12 15 6"></polyline>
        </svg>
      </button>
      <button 
        (click)="nextPage()" 
        [disabled]="!canGoNext()" 
        class="nav-button nav-next" 
        [class.disabled]="!canGoNext()">
        <svg class="icon-nav" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
      </button>
    </div>
  </div>
</div>

<!-- Popup -->
<div class="popup-overlay" *ngIf="showPopup">
  <div class="popup-container">
    <button class="close-button" (click)="closePopup()">
      <svg viewBox="0 0 24 24" fill="none">
        <path d="M18 6L6 18M6 6l12 12" stroke-linecap="round"/>
      </svg>
    </button>

    <div class="popup-header">
      <div class="floating-element rocket">üöÄ</div>
      <div class="floating-element star1">‚≠ê</div>
      <div class="floating-element star2">‚ú®</div>
      <div class="floating-element planet">üåç</div>

      <div class="header-content">
        <div class="welcome-badge">{{ translations.welcomeBadge }}</div>
        <h1 class="popup-title">
          {{ translations.popupTitle }}<br>
          <span class="title-highlight">{{ translations.popupTitleHighlight }}</span>
        </h1>
      </div>
    </div>

    <div class="popup-body">
      <div class="message-section">
        <p class="message-text">
          {{ translations.popupMessage1 }}
        </p>
        <p class="message-text">
          {{ translations.popupMessage2 }}
        </p>
      </div>

      <div class="features-grid">
        <div class="feature-card">
          <span class="feature-icon"></span>
          <h3 class="feature-title">{{ translations.popupFeature1Title }}</h3>
          <p class="feature-desc">{{ translations.popupFeature1Desc }}</p>
        </div>
        <div class="feature-card">
          <span class="feature-icon"></span>
          <h3 class="feature-title">{{ translations.popupFeature2Title }}</h3>
          <p class="feature-desc">{{ translations.popupFeature2Desc }}</p>
        </div>
        <div class="feature-card">
          <span class="feature-icon"></span>
          <h3 class="feature-title">{{ translations.popupFeature3Title }}</h3>
          <p class="feature-desc">{{ translations.popupFeature3Desc }}</p>
        </div>
      </div>

      <p class="cta-text">
        {{ translations.popupCta }}
      </p>

      <button class="action-button" (click)="closePopup()">
        <span>{{ translations.discoverButton }}</span>
        <span class="button-icon">‚Üí</span>
      </button>
    </div>
  </div>
</div>