<!-- ================= HTML TEMPLATE ================= -->
<div class="background-shapes">
  <div class="shape shape1"></div>
  <div class="shape shape2"></div>
  <div class="shape shape3"></div>
</div>

<!-- BOUTON AIDE FLOTTANT -->
<button class="help-button" (click)="openGuide()" [title]="getLabel('Aide')">
  <span>?</span>
</button>

<div class="container">
  <div class="form-card">
    <form (ngSubmit)="saveFormation()" #form="ngForm">

      <!-- ================= INFORMATIONS G√âN√âRALES ================= -->
      <div class="form-section">
        <h2 class="section-title">{{ getLabel('Informations G√©n√©rales') }}</h2>

        <div class="form-grid">
          <div class="form-group full-width">
            <label>{{ getLabel('Intitul√© de la formation *') }}</label>
            <input
              type="text"
              name="intitule"
              [(ngModel)]="newFormation.intitule"
              [placeholder]="getLabel('Ex: Formation Angular avanc√©')"
              required
            />
          </div>

          <div class="form-group">
            <label>{{ getLabel('Population cible *') }}</label>
            <input
              type="text"
              name="population"
              [(ngModel)]="newFormation.population"
              [placeholder]="getLabel('Ex: D√©veloppeurs, Consultants...')"
              required
            />
          </div>
        </div>

        <div class="form-grid three-cols">
          <div class="form-group">
            <label>{{ getLabel('Axe *') }}</label>
            <select name="axe" [(ngModel)]="newFormation.axe" required>
              <option *ngFor="let opt of getAxeOptions()" [value]="opt.value" [disabled]="opt.value === ''">
                {{ opt.label }}
              </option>
            </select>
          </div>

          <div class="form-group">
            <label>{{ getLabel('Niveau *') }}</label>
            <select name="niveau" [(ngModel)]="newFormation.niveau" required>
              <option *ngFor="let opt of getNiveauOptions()" [value]="opt.value">
                {{ opt.label }}
              </option>
            </select>
          </div>

          <div class="form-group">
            <label>{{ getLabel('Parcours') }}</label>
            <select name="parcours" [(ngModel)]="newFormation.parcours">
              <option *ngFor="let opt of getParcoursOptions()" [value]="opt.value">
                {{ opt.label }}
              </option>
            </select>
          </div>
        </div>

        <!-- PAYS - Affich√© uniquement si Parcours = OnBoarding -->
        <div *ngIf="newFormation.parcours === 'OnBoarding'" class="form-group full-width">
          <label>{{ getLabel('Pays') }}</label>
          <div class="checkbox-group">
            <div *ngFor="let p of paysList" class="checkbox-item">
              <input 
                type="checkbox"
                [id]="'new-pays-' + p.id_pays"
                [value]="p.id_pays"
                [checked]="isNewPaysSelected(p.id_pays)"
                (change)="toggleNewPays(p.id_pays)"
              />
              <label [for]="'new-pays-' + p.id_pays">{{ p.nom }}</label>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label>{{ getLabel('Dur√©e') }}</label>
          <input
            type="text"
            name="duree"
            [(ngModel)]="newFormation.duree"
            [placeholder]="getLabel('Ex: 2 jours, 14 heures...')"
          />
        </div>
      </div>

    <!-- ================= INTERNE / EXTERNE (Section modifi√©e) ================= -->
<div class="form-section">
  <h2 class="section-title">{{ getLabel('Type de Formation') }}</h2>
  
  <div class="form-grid">
    <div class="form-group">
      <label>{{ getLabel('Interne / Externe *') }}</label>
      <select
        name="interne_externe"
        [(ngModel)]="newFormation.interne_externe"
        (ngModelChange)="onInterneExterneChange()"
        required
      >
        <option *ngFor="let opt of getInterneExterneOptions()" [value]="opt.value">
          {{ opt.label }}
        </option>
      </select>
    </div>

    <!-- ‚úÖ NOUVEAU : Afficher le nom du formateur connect√© (non modifiable) -->
    <div
      class="form-group"
      *ngIf="newFormation.interne_externe === 'interne'"
    >
      <label>{{ getLabel('Formateur interne *') }}</label>
      <input
        type="text"
        [value]="currentUserName"
        readonly
        class="readonly-input"
        style="background-color: #f5f5f5; cursor: not-allowed;"
      />
      <!-- Champ cach√© pour envoyer l'ID -->
      <input
        type="hidden"
        [(ngModel)]="newFormation.id_formateur"
        name="id_formateur"
      />
    </div>

    <!-- EXTERNE - Show prestataire input -->
    <div
      class="form-group"
      *ngIf="newFormation.interne_externe === 'externe'"
    >
      <label>{{ getLabel('Prestataire *') }}</label>
      <input
        type="text"
        name="prestataire"
        [(ngModel)]="newFormation.prestataire"
        [placeholder]="getLabel('Nom du prestataire')"
        required
      />
    </div>
  </div>
</div>

      <!-- ================= OBJECTIFS ================= -->
      <div class="form-section">
        <h2 class="section-title">{{ getLabel('Objectifs *') }}</h2>

        <div
          class="form-group-with-remove"
          *ngFor="let obj of newFormation.objectifs; let i = index"
        >
          <input
            type="text"
            [(ngModel)]="newFormation.objectifs[i]"
            [name]="'objectif_' + i"
            [placeholder]="getLabel('Saisir un objectif')"
            required
          />
          <button
            type="button"
            class="btn-remove"
            *ngIf="newFormation.objectifs.length > 1"
            (click)="removeObjectif(i)"
            [title]="getLabel('Supprimer cet objectif')"
          >
            ‚úï
          </button>
        </div>

        <button
          type="button"
          class="btn-add-small"
          (click)="addObjectif()"
        >
          {{ getLabel('+ Ajouter un objectif') }}
        </button>
      </div>

      <!-- ================= COMP√âTENCES ================= -->
      <div class="form-section">
        <h2 class="section-title">{{ getLabel('Comp√©tences *') }}</h2>

        <div
          class="form-group-with-remove"
          *ngFor="let comp of newFormation.competences; let i = index"
        >
          <input
            type="text"
            [(ngModel)]="newFormation.competences[i]"
            [name]="'competence_' + i"
            [placeholder]="getLabel('Saisir une comp√©tence')"
            required
          />
          <button
            type="button"
            class="btn-remove"
            *ngIf="newFormation.competences.length > 1"
            (click)="removeCompetence(i)"
            [title]="getLabel('Supprimer cette comp√©tence')"
          >
            ‚úï
          </button>
        </div>

        <button
          type="button"
          class="btn-add-small"
          (click)="addCompetence()"
        >
          {{ getLabel('+ Ajouter une comp√©tence') }}
        </button>
      </div>

      <!-- ================= PR√âREQUIS ================= -->
      <div class="form-section">
        <div class="form-group full-width">
          <label>{{ getLabel('Pr√©requis *') }}</label>
          <textarea
            name="prerequis"
            [(ngModel)]="newFormation.prerequis"
            [placeholder]="getLabel('D√©crivez les pr√©requis n√©cessaires pour cette formation...')"
            rows="4"
            required
          ></textarea>
        </div>
      </div>

      <!-- ================= ACTIONS ================= -->
      <div class="actions-bar">
        <button
          type="button"
          class="cancel-btn"
          (click)="resetForm()"
        >
          <span>{{ getLabel('R√©initialiser') }}</span>
        </button>
        <button
          type="submit"
          class="submit-btn"
          [disabled]="form.invalid"
        >
          <span>{{ getLabel('Ajouter la formation') }}</span>
          <span>‚úì</span>
        </button>
      </div>

    </form>
  </div>
</div>

<!-- ================= MODAL GUIDE FORMATEUR ================= -->
<div class="modal-backdrop guide-overlay" *ngIf="guideOpen">
  <div class="modal guide-modal-clean">

    <!-- HEADER -->
    <div class="guide-header-clean">
      <h2>{{ getLabel('Guide d\'utilisation') }}</h2>
    </div>

    <!-- PROGRESS -->
    <div class="progress-clean">
      <div
        class="progress-fill"
        [style.width.%]="(currentGuideStep / totalGuideSteps) * 100">
      </div>
    </div>

    <!-- CONTENT -->
   <!-- CONTENT -->
    <div class="guide-content-clean">

      <!-- STEP 1 : Bienvenue -->
      <div *ngIf="currentGuideStep === 1" class="step-clean">
        <h3>{{ getLabel('Bienvenue dans l\'espace Formateur') }}</h3>
        <p>
          {{ getLabel('En tant que formateur, vous pouvez cr√©er et proposer des formations. Toute formation cr√©√©e sera soumise √† validation par l\'administrateur.') }}
        </p>
        
        <div class="step-info-bar">
          <span class="icon">üí°</span>
          <span class="text">{{ getLabel('Astuce : Toutes vos formations n√©cessitent une validation administrative') }}</span>
        </div>
      </div>

      <!-- STEP 2 : Cr√©er une formation -->
      <div *ngIf="currentGuideStep === 2" class="step-clean">
        <h3>{{ getLabel('Cr√©er une formation') }}</h3>
        <div class="guide-info-box">
          <div class="info-icon">‚ûï</div>
          <div class="info-content">
            <h4>{{ getLabel('Ajouter une formation') }}</h4>
            <p>{{ getLabel('Remplissez le formulaire pour cr√©er une nouvelle formation.') }}</p>
            <div class="status-badge-info">
              <span class="badge-inline pending">{{ getLabel('En attente') }}</span>
              <span>{{ getLabel('Votre formation sera mise en attente de validation.') }}</span>
            </div>
          </div>
        </div>
        
        <div class="step-info-bar">
          <span class="icon">üìù</span>
          <span class="text">{{ getLabel('Plus votre formation est d√©taill√©e, plus elle a de chances d\'√™tre valid√©e rapidement') }}</span>
        </div>
      </div>

      <!-- STEP 3 : Statuts des formations -->
      <div *ngIf="currentGuideStep === 3" class="step-clean">
        <p>{{ getLabel('Vos formations peuvent avoir 3 statuts diff√©rents :') }}</p>
        
        <div class="status-cards">
          <div class="status-card pending-card">
            <span class="badge-inline pending">{{ getLabel('En attente') }}</span>
            <p>{{ getLabel('Formation soumise, en attente de validation par l\'administrateur') }}</p>
          </div>
          
          <div class="status-card validated-card">
            <span class="badge-inline validated">{{ getLabel('Valid√©e') }}</span>
            <p>{{ getLabel('Formation approuv√©e et publi√©e par l\'administrateur') }}</p>
          </div>
          
          <div class="status-card rejected-card">
            <span class="badge-inline rejected">{{ getLabel('Refus√©e') }}</span>
            <p>{{ getLabel('Formation non approuv√©e. Vous pouvez la modifier et la resoumettre') }}</p>
          </div>
        </div>
        
        <div class="step-info-bar">
          <span class="icon">‚è±Ô∏è</span>
          <span class="text">{{ getLabel('Le d√©lai de validation d√©pend de la disponibilit√© de l\'administrateur') }}</span>
        </div>
      </div>

      <!-- STEP 4 : Modifier/Supprimer -->
      <div *ngIf="currentGuideStep === 4" class="step-clean">
        <h3>{{ getLabel('Modifier ou supprimer') }}</h3>
        <div class="guide-info-box warning-box">
          <div class="info-icon">‚ö†Ô∏è</div>
          <div class="info-content">
            <h4>{{ getLabel('Limitation importante') }}</h4>
            <p>{{ getLabel('Vous pouvez modifier ou supprimer uniquement les formations ayant le statut :') }}</p>
            <ul class="guide-list">
              <li><span class="badge-inline pending">{{ getLabel('En attente') }}</span></li>
              <li><span class="badge-inline rejected">{{ getLabel('Refus√©e') }}</span></li>
            </ul>
            <p class="note-text">{{ getLabel('Les formations Valid√©es ne peuvent plus √™tre modifi√©es.') }}</p>
          </div>
        </div>
        
        <div class="step-info-bar">
          <span class="icon">üîí</span>
          <span class="text">{{ getLabel('Les formations valid√©es sont prot√©g√©es pour garantir leur int√©grit√©') }}</span>
        </div>
      </div>

      <!-- STEP 5 : Historique -->
      <div *ngIf="currentGuideStep === 5" class="step-clean">
        <h3>{{ getLabel('Consulter l\'historique') }}</h3>
        <div class="guide-info-box">
          <div class="info-icon">üìã</div>
          <div class="info-content">
            <h4>{{ getLabel('Voir toutes vos formations') }}</h4>
            <p>{{ getLabel('Dans le tableau, vous pouvez consulter l\'historique complet :') }}</p>
            <ul class="guide-list">
              <li> {{ getLabel('Formations en attente de validation') }}</li>
              <li>{{ getLabel('Formations valid√©es et publi√©es') }}</li>
              <li>{{ getLabel('Formations refus√©es avec raison du refus') }}</li>
            </ul>
            <p class="tip-text">üí° {{ getLabel('Utilisez les filtres pour trier par statut') }}</p>
          </div>
        </div>
        
        <div class="step-info-bar">
          <span class="icon">üîç</span>
          <span class="text">{{ getLabel('Consultez r√©guli√®rement l\'historique pour suivre l\'√©volution de vos formations') }}</span>
        </div>
      </div>

      <!-- STEP 6 : Bonnes pratiques -->
      <div *ngIf="currentGuideStep === 6" class="step-clean">
        <h3>{{ getLabel('Bonnes pratiques') }}</h3>
        <div class="practices-grid">
          <div class="practice-card">
            <div class="practice-icon">‚úì</div>
            <div class="practice-content">
              <h4>{{ getLabel('Objectifs clairs') }}</h4>
              <p>{{ getLabel('D√©finissez des objectifs p√©dagogiques pr√©cis et mesurables') }}</p>
            </div>
          </div>
          
          <div class="practice-card">
            <div class="practice-icon">‚úì</div>
            <div class="practice-content">
              <h4>{{ getLabel('Comp√©tences associ√©es') }}</h4>
              <p>{{ getLabel('Listez les comp√©tences que les participants vont acqu√©rir') }}</p>
            </div>
          </div>
          
          <div class="practice-card">
            <div class="practice-icon">‚úì</div>
            <div class="practice-content">
              <h4>{{ getLabel('Informations compl√®tes') }}</h4>
              <p>{{ getLabel('Renseignez tous les champs (dur√©e, pr√©requis, population cible)') }}</p>
            </div>
          </div>
          
          <div class="practice-card">
            <div class="practice-icon">‚úì</div>
            <div class="practice-content">
              <h4>{{ getLabel('V√©rification') }}</h4>
              <p>{{ getLabel('Relisez votre formation pour √©viter les refus') }}</p>
            </div>
          </div>
        </div>
        
        <div class="step-info-bar">
          <span class="icon">üéØ</span>
          <span class="text">{{ getLabel('Une formation bien pr√©par√©e a plus de chances d\'√™tre valid√©e du premier coup') }}</span>
        </div>
      </div>

    </div>
    <!-- ACTIONS -->
    <div class="guide-footer-clean">
      <button
        class="btn-secondary"
        (click)="previousStep()"
        [disabled]="currentGuideStep === 1">
        {{ getLabel('Pr√©c√©dent') }}
      </button>

      <button
        class="btn-primary"
        *ngIf="currentGuideStep < totalGuideSteps"
        (click)="nextStep()">
        {{ getLabel('Suivant') }}
      </button>

      <button
        class="btn-primary"
        *ngIf="currentGuideStep === totalGuideSteps"
        (click)="closeGuide()">
        {{ getLabel('Commencer') }}
      </button>
    </div>

  </div>
</div>