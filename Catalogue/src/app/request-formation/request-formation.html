<div class="container">
  <!-- INDICATEUR DE TRADUCTION -->
  <div class="translation-indicator" *ngIf="isTranslating">
    <span class="spinner"></span> {{ getLabel('Traduction en cours...') }}
  </div>

  <div class="header">
    <h2>{{ getLabel('Formations en Attente de Validation') }}</h2>
    <span class="count-badge">{{ formationRequests.length }} {{ getLabel('formation(s)') }}</span>
  </div>

  <!-- Message si aucune demande -->
  <div *ngIf="formationRequests.length === 0" class="no-requests">
    <p>{{ getLabel('Aucune formation en attente de validation') }}</p>
  </div>

  <!-- TABLEAU FORMATIONS -->
  <table *ngIf="formationRequests.length > 0" class="table">
    <thead>
      <tr>
        <th>{{ getLabel('Intitulé') }}</th>
        <th>{{ getLabel('Axe') }}</th>
        <th>{{ getLabel('Niveau') }}</th>
        <th>{{ getLabel('Population') }}</th>
        <th>{{ getLabel('Formateur') }}</th>
        <th>{{ getLabel('Type') }}</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let request of getDisplayedFormations(); trackBy: trackFormation" 
          (click)="openDetailModal(request)" 
          style="cursor: pointer;">
        <td>{{ request.intitule }}</td>
        <td>
          <div>{{ request.axe }}</div>
          <small *ngIf="request.axe_code" style="color: #666;">{{ request.axe_code }}</small>
        </td>
        <td>
          <span class="badge" [ngClass]="request.niveau">{{ request.niveau }}</span>
        </td>
        <td>{{ request.population || getLabel('Non spécifié') }}</td>
        <td>
          <span *ngIf="request.nom_formateur; else noFormateur">
            {{ request.nom_formateur }} {{ request.prenom_formateur }}
          </span>
          <ng-template #noFormateur>
            <span style="color: #999;">{{ getLabel('Non assigné') }}</span>
          </ng-template>
        </td>
        <td>
          <span class="badge-type" [ngClass]="request.interne_externe || 'non-defini'">
            {{ request.interne_externe || getLabel('Non défini') }}
          </span>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<!-- ================= MODAL DÉTAILS ================= -->
<div *ngIf="detailModalOpen && getDisplayedSelectedRequest()" class="modal-backdrop">
  <div class="modal">
    <div class="modal-header">
      <h2>{{ getLabel('Détails de la Formation') }}</h2>
      <button class="close-btn" (click)="closeDetailModal()">✕</button>
    </div>

    <div class="modal-content">
      <!-- INFORMATIONS GÉNÉRALES -->
      <div class="section">
        <h3>{{ getLabel('Informations générales') }}</h3>
        <div class="info-grid">
          <div class="info-item">
            <span class="label">{{ getLabel('Intitulé :') }}</span>
            <span class="value">{{ getDisplayedSelectedRequest()?.intitule }}</span>
          </div>
          <div class="info-item">
            <span class="label">{{ getLabel('Axe :') }}</span>
            <span class="value">{{ getDisplayedSelectedRequest()?.axe }}</span>
          </div>
          <div class="info-item" *ngIf="getDisplayedSelectedRequest()?.axe_code">
            <span class="label">{{ getLabel('Code Axe :') }}</span>
            <span class="value">{{ getDisplayedSelectedRequest()?.axe_code }}</span>
          </div>
          <div class="info-item">
            <span class="label">{{ getLabel('Niveau :') }}</span>
            <span class="badge" [ngClass]="getDisplayedSelectedRequest()?.niveau">
              {{ getDisplayedSelectedRequest()?.niveau }}
            </span>
          </div>
          <div class="info-item">
            <span class="label">{{ getLabel('Population :') }}</span>
            <span class="value">{{ getDisplayedSelectedRequest()?.population || getLabel('Non spécifié') }}</span>
          </div>
          <div class="info-item">
            <span class="label">{{ getLabel('Type :') }}</span>
            <span class="value">{{ getDisplayedSelectedRequest()?.interne_externe || getLabel('Non spécifié') }}</span>
          </div>
        </div>
      </div>

      <!-- FORMATEUR -->
      <div class="section" *ngIf="selectedRequest?.id_formateur">
        <h3>{{ getLabel('Formateur') }}</h3>
        <div class="info-grid">
          <div class="info-item">
            <span class="label">{{ getLabel('Nom :') }}</span>
            <span class="value">{{ selectedRequest?.nom_formateur }} {{ selectedRequest?.prenom_formateur }}</span>
          </div>
        </div>
      </div>

      <!-- DESCRIPTION -->
      <div class="section" *ngIf="getDisplayedSelectedRequest()?.description">
        <h3>{{ getLabel('Description') }}</h3>
        <p class="text-content">{{ getDisplayedSelectedRequest()?.description }}</p>
      </div>

      <!-- PRÉREQUIS -->
      <div class="section" *ngIf="getDisplayedSelectedRequest()?.prerequis">
        <h3>{{ getLabel('Prérequis') }}</h3>
        <p class="text-content">{{ getDisplayedSelectedRequest()?.prerequis }}</p>
      </div>

      <!-- OBJECTIFS -->
      <div class="section">
        <h3>{{ getLabel('Objectifs pédagogiques') }}</h3>
        <ul *ngIf="getDisplayedObjectifs().length > 0; else noObjectifs">
          <li *ngFor="let obj of getDisplayedObjectifs(); trackBy: trackObjectif">{{ obj.libelle }}</li>
        </ul>
        <ng-template #noObjectifs>
          <p class="no-data">{{ getLabel('Aucun objectif défini') }}</p>
        </ng-template>
      </div>

      <!-- COMPÉTENCES -->
      <div class="section">
        <h3>{{ getLabel('Compétences visées') }}</h3>
        <ul *ngIf="getDisplayedCompetences().length > 0; else noCompetences">
          <li *ngFor="let comp of getDisplayedCompetences(); trackBy: trackCompetence">{{ comp.libelle }}</li>
        </ul>
        <ng-template #noCompetences>
          <p class="no-data">{{ getLabel('Aucune compétence définie') }}</p>
        </ng-template>
      </div>
    </div>

    <!-- ACTIONS -->
    <div class="modal-actions">
      <button type="button" class="btn-refuse" (click)="refuserFormation()">
        {{ getLabel('❌ Refuser') }}
      </button>
      <button type="button" class="btn-validate" (click)="validerFormation()">
        {{ getLabel('✅ Valider') }}
      </button>
    </div>
  </div>
</div>